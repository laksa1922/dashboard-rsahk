<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard Pompa & Tandon</title>

<style>
:root{
  --bg:#f5f7fa;--text:#333;--card:#fff;--shadow:rgba(0,0,0,.08);
  --head:#f0f2f5;--border:#eaeaea;--accent:#2c3e50;--blue:#3498db;
}
body.dark{
  --bg:#0f1115;--text:#eee;--card:#1b1e24;--shadow:rgba(0,0,0,.6);
  --head:#242831;--border:#333;--accent:#ecf0f1;
}
body{
  margin:0;padding:20px;font-family:Segoe UI,sans-serif;
  background:var(--bg);color:var(--text);
  transition:.3s;
}

/* HEADER */
.header{text-align:center;border-bottom:2px solid var(--blue);padding:20px}
.header h1{margin:0;font-size:2em;color:var(--accent)}
.header p{margin:5px;color:var(--blue);font-style:italic}

/* DARK TOGGLE */
.toggle-dark{
  position:fixed;top:15px;right:15px;width:42px;height:42px;
  border-radius:50%;border:none;background:var(--blue);
  color:#fff;font-size:18px;cursor:pointer;z-index:10;
}

/* CARD */
.card{
  background:var(--card);border-radius:14px;
  box-shadow:0 6px 15px var(--shadow);
  padding:18px;margin-bottom:20px;
}
.card-header{
  display:flex;justify-content:space-between;
  font-weight:700;font-size:1.1em;
}

/* TABLE */
.table-wrap{overflow-x:auto}
table{width:100%;border-collapse:collapse;font-size:.9em}
th,td{padding:8px;border-bottom:1px solid var(--border);text-align:center}
th{background:var(--head)}
tr:hover td{background:rgba(0,0,0,.04)}
body.dark tr:hover td{background:rgba(255,255,255,.05)}

/* BADGE */
.badge{
  padding:4px 10px;border-radius:6px;
  font-weight:700;color:#fff;display:inline-block;
}
.on{background:#27ae60;box-shadow:0 0 8px #27ae60}
.off,.rendah{background:#e74c3c}
.normal,.mcb-normal{background:#2980b9}
.penuh,.trip{background:#f1c40f;color:#000}

/* EFFECT */
.changed{animation:flash 1.3s}
@keyframes flash{
  0%{background:rgba(52,152,219,.15)}
  100%{background:transparent}
}

/* LOADER */
.loader{
  width:10px;height:10px;border-radius:50%;
  background:var(--blue);animation:pulse 1s infinite
}
@keyframes pulse{50%{transform:scale(1.6);opacity:.5}}

.footer{text-align:center;margin-top:30px;font-size:.9em}
</style>
</head>

<body>
<button class="toggle-dark" onclick="toggleDark()">üåô</button>

<div class="header">
  <h1>‚öôÔ∏è Monitoring Pompa & Tandon</h1>
  <p>Sistem Pemantauan Cerdas Real-time</p>
</div>

<div id="cards"></div>

<div class="footer">
‚ö° <b>Instalasi Pemelihara Sarana (IPS)</b><br>
RS Adi Husada Kapasari
</div>

<script>
/* ================= CONFIG ================= */
const CONFIG={
 joglo:{
  title:"üìç Joglo",
  url:"https://docs.google.com/spreadsheets/d/e/2PACX-1vTf9RrlaFN7h2UMkV_KRWJ0hU53Uwp2kCyjwduvxkvhv7rqJc7j71mXBai3hF3aW6R7EGYNzi5TWQSs/pub?gid=0&single=true&output=csv",
  headers:["Waktu","Status Pompa","Level Tandon","Suhu Pompa","RSSI","IP"],
  rules:(v,i)=>{
    v=v.toLowerCase();
    if(i==1) return v.includes("nyala")?"on":"off";
    if(i==2) return v.includes("rendah")?"rendah":v.includes("penuh")?"penuh":"normal";
  }
 },
 kantin:{
  title:"üìç Kantin",
  url:"https://docs.google.com/spreadsheets/d/e/2PACX-1vRp3hZufwknJEpOfvD_6YlB_lQEWwcJ-hMgKVfNoV1-jJAKeQB979Acs69cXCKCZVkf01OhwFn8fHlD/pub?gid=0&single=true&output=csv",
  headers:["Waktu","Status Pompa","Level Tandon","Suhu Pompa","MCB","RSSI","IP"],
  rules:(v,i)=>{
    v=v.toLowerCase();
    if(i==1) return v.includes("nyala")?"on":"off";
    if(i==2) return v.includes("rendah")?"rendah":v.includes("penuh")?"penuh":"normal";
    if(i==4) return v.includes("trip")?"trip":"mcb-normal";
  }
 },
 lt6:{
  title:"üìç Lantai 6",
  url:"https://docs.google.com/spreadsheets/d/e/2PACX-1vS2q5WkdqPKnd4D37-45O3LSc2KC7nMfRVDWz2crolUEyUOgnhuHxjGgU42BG0q_ddnl8vw_DJ_mcRV/pub?gid=0&single=true&output=csv",
  headers:["Waktu","Level Tandon"],
  rules:(v)=>v.toLowerCase().includes("rendah")?"rendah":v.includes("penuh")?"penuh":"normal"
 }
};

const lastValue={};

/* ================= CORE ================= */
function createCard(id,c){
 return `
 <div class="card">
  <div class="card-header">${c.title}<div class="loader" id="ld-${id}"></div></div>
  <div id="tb-${id}">Memuat...</div>
 </div>`;
}

function renderTable(key,row){
 const c=CONFIG[key];
 const cols=row.slice(0,c.headers.length);
 let html=`<div class="table-wrap"><table><tr>${c.headers.map(h=>`<th>${h}</th>`).join("")}</tr><tr>`;
 cols.forEach((v,i)=>{
  const cls=c.rules(v,i)||"";
  const ch=lastValue[key]?.[i]!==v;
  lastValue[key]??=[];
  lastValue[key][i]=v;
  html+=`<td class="${ch?"changed":""}">${cls?`<span class="badge ${cls}">${v}</span>`:v}</td>`;
 });
 html+="</tr></table></div>";
 return html;
}

async function loadAll(){
 await Promise.all(Object.keys(CONFIG).map(async k=>{
  document.getElementById("ld-"+k).style.display="inline-block";
  try{
   const t=await fetch(CONFIG[k].url).then(r=>r.text());
   const row=t.trim().split("\n")[1].split(",");
   document.getElementById("tb-"+k).innerHTML=renderTable(k,row);
  }catch{
   document.getElementById("tb-"+k).innerHTML="<b style=color:red>Offline</b>";
  }
  document.getElementById("ld-"+k).style.display="none";
 }));
}

/* ================= INIT ================= */
document.getElementById("cards").innerHTML=
 Object.entries(CONFIG).map(([k,c])=>createCard(k,c)).join("");

function toggleDark(){
 document.body.classList.toggle("dark");
 localStorage.theme=document.body.classList.contains("dark")?"dark":"light";
}

if(localStorage.theme==="dark")document.body.classList.add("dark");

loadAll();
setInterval(loadAll,10000);
</script>
</body>
</html>
