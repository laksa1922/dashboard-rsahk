<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Monitoring Pompa & Tandon</title>

<style>
:root{
 --bg:#f5f7fa;--text:#333;--card:#fff;--border:#eaeaea;
 --head:#f0f2f5;--accent:#3498db;
}
body.dark{
 --bg:#111;--text:#eee;--card:#1e1e1e;
 --border:#333;--head:#2a2a2a;
}
body{
 margin:0;padding:20px;font-family:Segoe UI,sans-serif;
 background:var(--bg);color:var(--text);transition:.3s;
}
.header{text-align:center;border-bottom:2px solid var(--accent);padding:15px}
.header h1{margin:0}
.header p{margin:4px;color:var(--accent);font-style:italic}

.toggle{
 position:fixed;top:15px;right:15px;
 width:38px;height:38px;border-radius:50%;
 border:none;background:var(--accent);
 color:#fff;font-size:18px;cursor:pointer;
}

.card{
 background:var(--card);border-radius:12px;
 padding:15px;margin:20px 0;
 box-shadow:0 4px 10px rgba(0,0,0,.1);
}
.card-header{
 display:flex;justify-content:space-between;
 font-weight:700;margin-bottom:6px
}
.last{font-size:.85em;color:gray;margin-bottom:8px}

table{width:100%;border-collapse:collapse;font-size:.9em}
th,td{
 padding:8px;border-bottom:1px solid var(--border);
 text-align:center
}
th{background:var(--head)}
.badge{
 padding:4px 10px;border-radius:6px;
 font-weight:700;color:#fff
}
.on{background:#27ae60}
.off,.rendah{background:#e74c3c}
.normal,.mcb-normal{background:#2980b9}
.penuh,.trip{background:#f1c40f;color:#000}

.loader{
 width:10px;height:10px;border-radius:50%;
 background:var(--accent);animation:pulse 1s infinite
}
@keyframes pulse{50%{transform:scale(1.6);opacity:.5}}

.footer{text-align:center;margin-top:30px;font-size:.85em}
</style>
</head>

<body>

<button class="toggle" onclick="toggleDark()">üåô</button>

<div class="header">
<h1>‚öôÔ∏è Monitoring Pompa & Tandon</h1>
<p>Sistem Pemantauan Cerdas Real-time</p>
</div>

<div id="joglo" class="card"></div>
<div id="kantin" class="card"></div>
<div id="lt6" class="card"></div>

<div class="footer">
‚ö° <b>Instalasi Pemelihara Sarana (IPS)</b><br>
RS Adi Husada Kapasari
</div>

<script>
const SRC={
 joglo:{
  title:"üìç Joglo",
  url:"https://docs.google.com/spreadsheets/d/e/2PACX-1vTf9RrlaFN7h2UMkV_KRWJ0hU53Uwp2kCyjwduvxkvhv7rqJc7j71mXBai3hF3aW6R7EGYNzi5TWQSs/pub?gid=0&single=true&output=csv",
  head:["Waktu","Pompa","Level","Suhu","RSSI","IP"],
  map:(v,i)=>{
   v=v.toLowerCase();
   if(i==1) return v.includes("nyala")?"on":"off";
   if(i==2) return v.includes("rendah")?"rendah":v.includes("penuh")?"penuh":"normal";
  }
 },
 kantin:{
  title:"üìç Kantin",
  url:"https://docs.google.com/spreadsheets/d/e/2PACX-1vRp3hZufwknJEpOfvD_6YlB_lQEWwcJ-hMgKVfNoV1-jJAKeQB979Acs69cXCKCZVkf01OhwFn8fHlD/pub?gid=0&single=true&output=csv",
  head:["Waktu","Pompa","Level","Suhu","MCB","RSSI","IP"],
  map:(v,i)=>{
   v=v.toLowerCase();
   if(i==1) return v.includes("nyala")?"on":"off";
   if(i==2) return v.includes("rendah")?"rendah":v.includes("penuh")?"penuh":"normal";
   if(i==4) return v.includes("trip")?"trip":"mcb-normal";
  }
 },
 lt6:{
  title:"üìç Lantai 6",
  url:"https://docs.google.com/spreadsheets/d/e/2PACX-1vS2q5WkdqPKnd4D37-45O3LSc2KC7nMfRVDWz2crolUEyUOgnhuHxjGgU42BG0q_ddnl8vw_DJ_mcRV/pub?gid=0&single=true&output=csv",
  head:["Waktu","Level"],
  map:v=>v.toLowerCase().includes("rendah")?"rendah":v.includes("penuh")?"penuh":"normal"
 }
};

function cardHTML(id){
 return `
 <div class="card-header">${SRC[id].title}<div class="loader" id="l-${id}"></div></div>
 <div class="last" id="t-${id}">Terakhir update: -</div>
 <div id="tb-${id}">Memuat...</div>`;
}

Object.keys(SRC).forEach(k=>{
 document.getElementById(k).innerHTML=cardHTML(k);
});

function table(key,row){
 const c=SRC[key];
 let h=`<table><tr>${c.head.map(x=>`<th>${x}</th>`).join("")}</tr><tr>`;
 row.slice(0,c.head.length).forEach((v,i)=>{
  const cls=c.map(v,i)||"";
  h+=`<td>${cls?`<span class="badge ${cls}">${v}</span>`:v}</td>`;
 });
 return h+"</tr></table>";
}

function load(key){
 document.getElementById("l-"+key).style.display="inline-block";
 fetch(SRC[key].url).then(r=>r.text()).then(t=>{
  const r=t.trim().split("\n")[1].split(",");
  document.getElementById("tb-"+key).innerHTML=table(key,r);
  document.getElementById("t-"+key).textContent=
   "Terakhir update: "+new Date().toLocaleTimeString("id-ID");
 }).catch(()=>{
  document.getElementById("tb-"+key).innerHTML="<b style=color:red>Gagal memuat</b>";
 }).finally(()=>{
  document.getElementById("l-"+key).style.display="none";
 });
}

function refresh(){Object.keys(SRC).forEach(load)}

function toggleDark(){
 document.body.classList.toggle("dark");
 localStorage.theme=document.body.classList.contains("dark")?"dark":"light";
}

if(localStorage.theme==="dark")document.body.classList.add("dark");

refresh();
setInterval(refresh,10000);
</script>
</body>
</html>
